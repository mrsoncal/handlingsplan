<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Handlingsplan</title>
  <style>
    @media (max-width: 600px) {
      .carousel-nav {
        display: none !important;
      }

      .carousel-track.stacked {
        display: block !important;
      }

      .carousel-slide {
        display: block !important;
        width: 100% !important;
        max-width: 100% !important;
        margin-bottom: 2rem;
      }

      .table-wrapper {
        width: 100% !important;
        overflow-x: auto !important;
      }

      .table-wrapper table {
        width: 100% !important;
        table-layout: auto !important;
      }

      .table-wrapper th,
      .table-wrapper td {
        width: auto !important;
        white-space: normal !important;
      }
    }
  </style>
</head>
<body>
  <div id="carousel-track" class="carousel-track"></div>
  <script>
    const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTf-bAq0V8H8vLpSSEzpf18GPcW7ZROEK-MMNvy99Mbz3Be8EQ63By7hGofAg5R2Od7KUYtr95w23JO/pub?output=csv";
    const isMobile = window.innerWidth <= 600;
    const track = document.getElementById("carousel-track");
    if (isMobile && track) track.classList.add("stacked");

    async function loadCSV() {
      try {
        const response = await fetch(csvUrl);
        const text = await response.text();

        const rows = text.trim().split("\n").map(row => row.split(","));
        const headers = rows[0];
        const data = rows.slice(1);

        const grouped = {};
        data.forEach(row => {
          const tema = row[2].trim();
          if (!grouped[tema]) grouped[tema] = [];
          grouped[tema].push(row);
        });

        const temaOrder = [
          "Ungdomsdemokrati og Medvirkning",
          "Samferdsel",
          "Utdanning og Kompetanse",
          "Folkehelse",
          "Klima og MiljÃ¸",
          "Kultur"
        ];

        temaOrder.forEach(tema => {
          const groupRows = grouped[tema];
          if (!groupRows || groupRows.length === 0) return;

          const slide = document.createElement("div");
          slide.className = "carousel-slide";

          const h2 = document.createElement("h2");
          h2.textContent = tema;
          slide.appendChild(h2);

          const table = document.createElement("table");
          const thead = document.createElement("thead");
          const tr = document.createElement("tr");

          headers.slice(1).forEach((h, index) => {
            if (index === 1) return;
            const th = document.createElement("th");
            th.textContent = h === "Velg et punkt (nr)" ? "punkt" : h;
            tr.appendChild(th);
          });

          thead.appendChild(tr);
          table.appendChild(thead);

          const tbody = document.createElement("tbody");
          groupRows.forEach(row => {
            const tr = document.createElement("tr");
            row.slice(1).forEach((cell, index) => {
              if (index === 1) return;
              const td = document.createElement("td");
              td.textContent = cell;
              tr.appendChild(td);
            });
            tbody.appendChild(tr);
          });

          table.appendChild(tbody);

          const wrapper = document.createElement("div");
          wrapper.className = "table-wrapper";
          wrapper.appendChild(table);
          slide.appendChild(wrapper);

          track.appendChild(slide);
        });
      } catch (error) {
        console.error("Failed to fetch CSV:", error);
      }
    }

    loadCSV();
  </script>
</body>
</html>