<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8">
  <title>Forslag til Handlingsplan 2026</title>
  <style>
    body {
      font-family: sans-serif;
      max-width: 1000px;
      margin: 2rem auto;
      padding: 1rem;
      overflow-x: hidden;
      position: relative;
    }

    h1 {
      font-size: 2rem;
      margin-bottom: 1.5rem;
      text-align: center;
    }

    #adminLoginBtn, #logoutBtn {
      position: absolute;
      top: 1rem;
      right: 1rem;
      padding: 0.75rem 1.25rem;
      font-size: 1rem;
      background: #444;
      color: white;
      border: none;
      cursor: pointer;
      z-index: 2001;
      border-radius: 5px;
    }

    #logoutBtn {
      display: none;
    }

    .carousel {
      position: relative;
      overflow: hidden;
    }

    .carousel-track {
      display: flex;
      transition: transform 0.5s ease-in-out;
      width: 100%;
    }

    .carousel-slide {
      min-width: 100%;
      box-sizing: border-box;
      padding: 0 1rem;
    }

    .carousel-nav {
      position: fixed;
      top: 50%;
      transform: translateY(-50%);
      font-size: 2rem;
      background: none;
      border: none;
      cursor: pointer;
      padding: 10rem;
      z-index: 1000;
    }

    .carousel-nav.left {
      left: 0;
    }

    .carousel-nav.right {
      right: 0;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 1rem;
    }

    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }

    th { background-color: #f9f9f9; }
    td.button-cell {
      border: none;
      background: none;
      padding: 0;
      text-align: right;
    }

    th.button-header { display: none; }
    .vedtatt td:not(.button-cell) { background-color: #d4edda !important; }
    .vedtatt td.button-cell { background-color: white !important; }

    .Legge\ til\ et\ punkt { background-color: #e6ffe6; }
    .Endre\ et\ punkt { background-color: #e6f0ff; }
    .Fjerne\ et\ punkt { background-color: #ffe6e6; }

    .vedta-button {
      display: none;
      padding: 0.5rem 1rem;
      font-size: 1rem;
      background: #e9e9e9;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    .vedta-button:hover {
      background: #cfcfcf;
    }

    .vedtatt .vedta-button {
      background: #28a745 !important;
    }

    #loginModal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
    }

    #loginModal form {
      background: white;
      padding: 3rem;
      border-radius: 12px;
      text-align: center;
      animation: popIn 0.3s ease-out;
    }

    #loginModal input[type="password"] {
      width: 80%;
      padding: 0.75rem;
      font-size: 1rem;
      margin-bottom: 1.5rem;
      border-radius: 6px;
      border: 1px solid #ccc;
    }

    #loginModal button[type="submit"] {
      padding: 0.75rem 1.5rem;
      font-size: 1rem;
      background: #28a745;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    #loginModal button[type="submit"]:hover {
      background: #218838;
    }

    @keyframes popIn {
      0% { transform: scale(0.9); opacity: 0; }
      100% { transform: scale(1); opacity: 1; }
    }
  </style>
</head>
<body>
  <h1>Handlingsplan</h1>

  <button id="adminLoginBtn" onclick="showLogin()">Admin</button>
  <button id="logoutBtn" onclick="logout()">Logg ut</button>

  <div id="loginModal">
    <form onsubmit="return checkLogin(event)">
      <h2>Admin Login</h2>
      <input type="password" id="adminPass" placeholder="Passord" required>
      <br><br>
      <button type="submit">Logg inn</button>
    </form>
  </div>

  <button class="carousel-nav left" onclick="prevSlide()">&#10094;</button>
  <button class="carousel-nav right" onclick="nextSlide()">&#10095;</button>

  <div class="carousel">
    <div class="carousel-track" id="carousel-track"></div>
  </div>

  <script>
    const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTf-bAq0V8H8vLpSSEzpf18GPcW7ZROEK-MMNvy99Mbz3Be8EQ63By7hGofAg5R2Od7KUYtr95w23JO/pub?output=csv";
    let currentIndex = 0;

    function showLogin() {
      document.getElementById("loginModal").style.display = "flex";
    }

    function checkLogin(event) {
      event.preventDefault();
      const password = document.getElementById("adminPass").value;
      if (password === "admin123") {
        document.getElementById("loginModal").style.display = "none";
        document.querySelectorAll(".vedta-button").forEach(btn => btn.style.display = "inline-block");
        document.getElementById("adminLoginBtn").style.display = "none";
        document.getElementById("logoutBtn").style.display = "inline-block";
        localStorage.setItem("adminLoggedIn", "true");
      } else {
        alert("Feil passord. Prøv igjen.");
      }
    }

    function logout() {
      document.querySelectorAll(".vedta-button").forEach(btn => btn.style.display = "none");
      document.getElementById("adminLoginBtn").style.display = "inline-block";
      document.getElementById("logoutBtn").style.display = "none";
      localStorage.removeItem("adminLoggedIn");
    }

    function checkStoredLogin() {
      if (localStorage.getItem("adminLoggedIn") === "true") {
        document.querySelectorAll(".vedta-button").forEach(btn => btn.style.display = "inline-block");
        document.getElementById("adminLoginBtn").style.display = "none";
        document.getElementById("logoutBtn").style.display = "inline-block";
      }
    }

    async function loadCSV() {
      const response = await fetch(csvUrl);
      const text = await response.text();
      const rows = text.trim().split("\n").map(row => row.split(","));
      const headers = rows[0];
      const data = rows.slice(1);

      const grouped = {};
      data.forEach(row => {
        const tema = row[2].trim();
        if (!grouped[tema]) grouped[tema] = [];
        grouped[tema].push(row);
      });

      const temaOrder = [
        "Ungdomsdemokrati og Medvirkning",
        "Samferdsel",
        "Utdanning og Kompetanse",
        "Folkehelse",
        "Klima og Miljø",
        "Kultur"
      ];

      const track = document.getElementById("carousel-track");

      temaOrder.forEach(tema => {
        const groupRows = grouped[tema];
        if (!groupRows || groupRows.length === 0) return;

        const slide = document.createElement("div");
        slide.className = "carousel-slide";

        const h2 = document.createElement("h2");
        h2.textContent = tema;
        slide.appendChild(h2);

        const table = document.createElement("table");
        const thead = document.createElement("thead");
        const tr = document.createElement("tr");

        headers.slice(1).forEach((h, index) => {
          if (index === 1) return; // skip Tema
          const th = document.createElement("th");
          th.textContent = h === "Velg et punkt (nr)" ? "punkt" : h;
          const widths = [150, 60, 200, 200, 200];
          const visibleIndex = index < 1 ? index : index - 1;
          th.style.width = widths[visibleIndex] + "px";
          if (index === 2) th.style.textAlign = "center";
          tr.appendChild(th);
        });

        const thBtn = document.createElement("th");
        thBtn.className = "button-header";
        tr.appendChild(thBtn);
        thead.appendChild(tr);
        table.appendChild(thead);

        const tbody = document.createElement("tbody");
        const order = ["Legge til et punkt", "Endre et punkt", "Fjerne et punkt"];
        groupRows.sort((a, b) => {
          const aPunkt = parseInt(a[3], 10) || 0;
          const bPunkt = parseInt(b[3], 10) || 0;
          if (aPunkt !== bPunkt) return aPunkt - bPunkt;
          return order.indexOf(a[1]) - order.indexOf(b[1]);
        }).forEach(row => {
          const tr = document.createElement("tr");
          tr.className = row[1].trim().replace(/\s/g, "\\ ");

          row.slice(1).forEach((cell, index) => {
            if (index === 1) return;
            const td = document.createElement("td");
            const widths = [150, 60, 200, 200, 200];
            const visibleIndex = index < 1 ? index : index - 1;
            td.style.width = widths[visibleIndex] + "px";
            if (index === 2) td.style.textAlign = "center";
            td.textContent = cell;
            tr.appendChild(td);
          });

          const tdAction = document.createElement("td");
          tdAction.className = "button-cell";
          const btn = document.createElement("button");
          btn.textContent = "Vedta";
          btn.className = "vedta-button";
          btn.onclick = () => {
            tr.classList.toggle("vedtatt");
          };
          tdAction.appendChild(btn);
          tr.appendChild(tdAction);

          tbody.appendChild(tr);
        });

        table.appendChild(tbody);
        slide.appendChild(table);
        track.appendChild(slide);
      });

      updateCarousel();
      checkStoredLogin();
    }

    function updateCarousel() {
      const track = document.getElementById("carousel-track");
      const totalSlides = track.children.length;
      currentIndex = (currentIndex + totalSlides) % totalSlides;
      track.style.transform = `translateX(-${currentIndex * 100}%)`;
    }

    function nextSlide() {
      currentIndex++;
      updateCarousel();
    }

    function prevSlide() {
      currentIndex--;
      updateCarousel();
    }

    window.addEventListener("DOMContentLoaded", loadCSV);
  </script>
</body>
</html>
