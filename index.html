<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8">
  <title>Forslag til Handlingsplan 2026</title>
  <style>
    body {
      font-family: sans-serif;
      max-width: 1000px;
      margin: 2rem auto;
      padding: 1rem;
      overflow-x: hidden;
      position: relative;
      animation: fadeInPage 0.6s ease-out;
    }

    @keyframes fadeInPage {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    h1 {
      font-size: 2rem;
      margin-bottom: 1.5rem;
      text-align: center;
      animation: popIn 0.4s ease-in-out;
    }

    .carousel-slide {
      animation: slideIn 0.5s ease-in-out;
    }

    @keyframes slideIn {
      0% { opacity: 0; transform: translateX(30px); }
      100% { opacity: 1; transform: translateX(0); }
    }

    table {
      border-collapse: separate;
      border-spacing: 0;
      width: 100%;
      margin-top: 1rem;
      animation: fadeIn 0.4s ease-in;
      border-left: 2px solid black;
      border-top: 2px solid black;
      border-bottom: 2px solid black;
    }

    th, td {
      padding: 8px;
      text-align: left;
      border: none;
      transition: background-color 0.3s ease;
    }

    /* Apply right border to 'Endre til' column (6th column) */
    th:nth-child(6), td:nth-child(6) {
      border-right: 2px solid black;
    }

    /* Remove all borders and background from the entire button column (7th column) */
    th:nth-child(7), td:nth-child(7) {
      border: none !important;
      background: none;
      padding: 0;
    }

    .vedtatt td:nth-child(7) {
      background-color: white !important;
    }

    .vedtatt td.button-cell {
      background-color: white !important;
    }

    /* Optional: striped row background for readability */
    tbody tr:nth-child(even):not(.vedtatt) td:not(:nth-child(7)) {
      background-color: #fafafa;
    }

    tr:hover:not(.vedtatt) td:not(:nth-child(7)) {
      background-color: #dfdfdf !important;
    }

    /* Color coding for row types */
    .Legge\ til\ et\ punkt td:not(:nth-child(7)) {
      background-color: #e6ffe6;
      border-left: 5px solid #5cb85c;
    }

    .Endre\ et\ punkt td:not(:nth-child(7)) {
      background-color: #e6f0ff;
      border-left: 5px solid #0275d8;
    }

    .Fjerne\ et\ punkt td:not(:nth-child(7)) {
      background-color: #ffe6e6;
      border-left: 5px solid #d9534f;
    }
  </style>
</head>
<body>
<body>
  <h1>Handlingsplan</h1>

  <button id="adminLoginBtn" onclick="showLogin()">Admin</button>
  <button id="logoutBtn" onclick="logout()">Logg ut</button>

  <div id="loginModal">
    <form onsubmit="return checkLogin(event)">
      <h2>Admin Login</h2>
      <input type="password" id="adminPass" placeholder="Passord" required>
      <br><br>
      <button type="submit">Logg inn</button>
    </form>
  </div>

  <button class="carousel-nav left" onclick="prevSlide()">&#10094;</button>
  <button class="carousel-nav right" onclick="nextSlide()">&#10095;</button>

  <div class="carousel">
    <div class="carousel-track" id="carousel-track"></div>
  </div>

  <script>
    const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTf-bAq0V8H8vLpSSEzpf18GPcW7ZROEK-MMNvy99Mbz3Be8EQ63By7hGofAg5R2Od7KUYtr95w23JO/pub?output=csv";
    let currentIndex = 0;

    function showLogin() {
      document.getElementById("loginModal").style.display = "flex";
    }

    function checkLogin(event) {
      event.preventDefault();
      const password = document.getElementById("adminPass").value;
      if (password === "admin123") {
        document.getElementById("loginModal").style.display = "none";
        document.querySelectorAll(".vedta-button").forEach(btn => btn.style.display = "inline-block");
        document.getElementById("adminLoginBtn").style.display = "none";
        document.getElementById("logoutBtn").style.display = "inline-block";
        localStorage.setItem("adminLoggedIn", "true");
      } else {
        alert("Feil passord. Prøv igjen.");
      }
    }

    function logout() {
      document.querySelectorAll(".vedta-button").forEach(btn => btn.style.display = "none");
      document.getElementById("adminLoginBtn").style.display = "inline-block";
      document.getElementById("logoutBtn").style.display = "none";
      localStorage.removeItem("adminLoggedIn");
    }

    function checkStoredLogin() {
      if (localStorage.getItem("adminLoggedIn") === "true") {
        document.querySelectorAll(".vedta-button").forEach(btn => btn.style.display = "inline-block");
        document.getElementById("adminLoginBtn").style.display = "none";
        document.getElementById("logoutBtn").style.display = "inline-block";
      }
    }

    async function loadCSV() {
      const response = await fetch(csvUrl);
      const text = await response.text();
      const rows = text.trim().split("\n").map(row => row.split(","));
      const headers = rows[0];
      const data = rows.slice(1);

      const grouped = {};
      data.forEach(row => {
        const tema = row[2].trim();
        if (!grouped[tema]) grouped[tema] = [];
        grouped[tema].push(row);
      });

      const temaOrder = [
        "Ungdomsdemokrati og Medvirkning",
        "Samferdsel",
        "Utdanning og Kompetanse",
        "Folkehelse",
        "Klima og Miljø",
        "Kultur"
      ];

      const track = document.getElementById("carousel-track");

      temaOrder.forEach(tema => {
        const groupRows = grouped[tema];
        if (!groupRows || groupRows.length === 0) return;

        const slide = document.createElement("div");
        slide.className = "carousel-slide";

        const h2 = document.createElement("h2");
        h2.textContent = tema;
        slide.appendChild(h2);

        const table = document.createElement("table");
        const thead = document.createElement("thead");
        const tr = document.createElement("tr");

        headers.slice(1).forEach((h, index) => {
          if (index === 1) return; // skip Tema
          const th = document.createElement("th");
          th.textContent = h === "Velg et punkt (nr)" ? "punkt" : h;
          const widths = [150, 60, 200, 200, 200];
          const visibleIndex = index < 1 ? index : index - 1;
          th.style.width = widths[visibleIndex] + "px";
          if (index === 2) th.style.textAlign = "center";
          tr.appendChild(th);
        });

        const thBtn = document.createElement("th");
        thBtn.className = "button-header";
        tr.appendChild(thBtn);
        thead.appendChild(tr);
        table.appendChild(thead);

        const tbody = document.createElement("tbody");
        const order = ["Legge til et punkt", "Endre et punkt", "Fjerne et punkt"];
        groupRows.sort((a, b) => {
          const aPunkt = parseInt(a[3], 10) || 0;
          const bPunkt = parseInt(b[3], 10) || 0;
          if (aPunkt !== bPunkt) return aPunkt - bPunkt;
          return order.indexOf(a[1]) - order.indexOf(b[1]);
        }).forEach(row => {
          const tr = document.createElement("tr");
          tr.className = row[1].trim().replace(/\s/g, "\\ ");

          row.slice(1).forEach((cell, index) => {
            if (index === 1) return;
            const td = document.createElement("td");
            const widths = [150, 60, 200, 200, 200];
            const visibleIndex = index < 1 ? index : index - 1;
            td.style.width = widths[visibleIndex] + "px";
            if (index === 2) td.style.textAlign = "center";
            td.textContent = cell;
            tr.appendChild(td);
          });

          const tdAction = document.createElement("td");
          tdAction.className = "button-cell";
          const btn = document.createElement("button");
          btn.textContent = "Vedta";
          btn.className = "vedta-button";
          btn.onclick = () => {
            tr.classList.toggle("vedtatt");
          };
          tdAction.appendChild(btn);
          tr.appendChild(tdAction);

          tbody.appendChild(tr);
        });

        table.appendChild(tbody);
        slide.appendChild(table);
        track.appendChild(slide);
      });

      updateCarousel();
      checkStoredLogin();
    }

    function updateCarousel() {
      const track = document.getElementById("carousel-track");
      const totalSlides = track.children.length;
      currentIndex = (currentIndex + totalSlides) % totalSlides;
      track.style.transform = `translateX(-${currentIndex * 100}%)`;
    }

    function nextSlide() {
      currentIndex++;
      updateCarousel();
    }

    function prevSlide() {
      currentIndex--;
      updateCarousel();
    }

    window.addEventListener("DOMContentLoaded", loadCSV);
  </script>
</body>
</html>
